import{W as l,cZ as u,c_ as g,c$ as d,cX as f,d0 as y}from"./chunk-C4bXDfxA.js";import{y as n,e as v,s as o}from"./chunk-D_yTKJJf.js";const x=p=>{let a=class extends p{get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}get dataScaleRange(){const e=this.tileInfo.lods;let t=e[0].scale,i=e[e.length-1].scale;if("tilemapCache"in this.layer&&this.layer.tilemapCache){const{effectiveMinLOD:r,effectiveMaxLOD:s}=this.layer.tilemapCache;t=this.tileInfo.lodAt(r).scale,i=this.tileInfo.lodAt(s).scale}return{minScale:t,maxScale:i}}get dataLevelRange(){const{minScale:e,maxScale:t}=this.dataScaleRange;return this.levelRangeFromScaleRange(e,t)}get displayLevelRange(){const e=this.layer.minScale||this.dataScaleRange.minScale,t=this.layer.maxScale||this.dataScaleRange.maxScale,i=this.levelRangeFromScaleRange(e,t);return this.layer.maxScale&&i.maxLevel++,i}get performanceInfo(){return new d(this.view.basemapTerrain.getUsedMemoryForLayerView(this))}getTileUrl(e,t,i){return this.layer.getTileUrl(e,t,i)}_addTilingSchemeMatchPromise(){if(this.fullExtent==null)return this.addResolvingPromise(Promise.reject(new o("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));const e=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(e)return this.addResolvingPromise(Promise.reject(e));const t=f(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{const i=this.view.basemapTerrain.tilingScheme,r=this._getTileInfoCompatibilityError(this.tileInfo,i);if(r)throw r});this.addResolvingPromise(t)}_getTileInfoSupportError(e,t){const i=y(e,t,this.view.spatialReference,this.view.state.viewingMode);if(i){const r={layer:this.layer,error:i};let s;switch(i.name){case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":case"tilingscheme:local-unsupported-spatial-reference":s=new o("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",r);break;default:s=new o("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",r)}return s}return null}_getTileInfoCompatibilityError(e,t){return e!=null&&t.compatibleWith(e)?null:new o("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(e,t){const i={minLevel:0,maxLevel:1/0},r=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!r)return i;const s=r.levels[0],h=m=>{const c=Math.log(s.scale/m)/Math.LN2;return .5-Math.abs(.5-c%1)<1e-9?Math.round(c):Math.ceil(c)};return e!=null&&e>0&&(i.minLevel=Math.max(0,h(e))),t!=null&&t>0&&(i.maxLevel=Math.max(0,h(t))),i}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return l([n({readOnly:!0})],a.prototype,"imageFormatIsOpaque",null),l([n({readOnly:!0})],a.prototype,"updating",void 0),l([n(u)],a.prototype,"updatingProgress",void 0),l([n(g)],a.prototype,"updatingProgressValue",void 0),l([n()],a.prototype,"fullExtent",null),l([n({readOnly:!0})],a.prototype,"isOpaque",null),l([n()],a.prototype,"dataScaleRange",null),l([n({readOnly:!0})],a.prototype,"dataLevelRange",null),l([n({readOnly:!0})],a.prototype,"displayLevelRange",null),l([n()],a.prototype,"layer",void 0),a=l([v("esri.views.3d.layers.TiledLayerView3D")],a),a};export{x as c};
