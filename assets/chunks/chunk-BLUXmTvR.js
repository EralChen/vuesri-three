import{b3 as N,p9 as P,w as f,ey as g}from"./chunk-C4bXDfxA.js";import{y as C,e as A}from"./chunk-D_yTKJJf.js";import{a as O,b as S}from"./chunk-aIpoUDE5.js";import{V as z}from"./chunk-DwVxjFdS.js";import{e as D,_ as H,c as j}from"./chunk-C7IO9vs-.js";import{f as m,u as k,g as F,R as T,a as U,c as q,i as Q,G as R,b as W,V as I,Q as K,l as J,h as X}from"./chunk-4ztk2S2V.js";import{E as Y}from"./chunk-8EtOKnRZ.js";import{p as Z}from"./chunk-EBoT1v4r.js";import"./chunk-pqN9uQLb.js";import{M as ee}from"./chunk-BWfcRxIb.js";import{d as M,w as te,a as b,Q as re,R as se,j as B,b as L,c as ae,l as p,S as oe,r as ne,K as ie,U as V,s as h,p as $,m as u,e as le,f as w,t as ue,u as v,z as pe}from"./chunk-DZT0J2Fy.js";import"./chunk--6mYOZ3I.js";import"./chunk-CcyKeARz.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */const ce={source:{type:Array,default:()=>[]},radius:{type:Number,default:1500},color:{type:Object,default:new m(8759721)},textureUrl:{type:String,default:""}},he={load:o=>o,...D},me=M({name:"VathArcLayer",components:{VathEntityLayerEvents:H},props:ce,emits:he,setup(o,{emit:t}){const a=k(),s=j(t),e=new c({source:o.source});return te(()=>o.source,r=>{e.source=r,e.refresh()}),b(()=>{e.radius=o.radius}),b(()=>{e.color=o.color}),b(()=>{o.textureUrl?e.texture=function(){const r=new F().load(o.textureUrl);return r.wrapS=T,r.wrapT=T,r.repeat.set(1,1),r}():e.texture=null}),U(a,e),t("load",{layer:e,renderer:a,view:a.view}),re("vathEntityLayer",e),{eventsEmits:s}}});function de(o,t,a,s,e,r){const n=B("VathEntityLayerEvents");return L(),ae(ie,null,[p(n,oe(o.eventsEmits),null,16),ne(o.$slots,"default")],64)}const x=se(me,[["render",de]]);var ye=Object.defineProperty,fe=Object.getOwnPropertyDescriptor,_=(o,t,a,s)=>{for(var e=s>1?void 0:s?fe(t,a):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(e=(s?n(t,a,e):n(e))||e);return s&&e&&ye(t,a,e),e};class ge{constructor(t){this.group=new R,this.paths=[],this.lines=[],this.layer=t.layer,this.graphic=t.graphic}setup(){this.lines=[],this.paths=this.pathsFromGraphic();const a=this.paths.reduce((s,e)=>(V(e,3).forEach(n=>{s.push(this.createThreeGeomety(n))}),s),[]).map(s=>{const e=new R,r=new W(s,this.layer.getMaterial());return this.lines.push(r.geometry),e.add(r),e});this.group.add(...a),this.layer.group.add(this.group)}dispose(){this.group.clear(),this.layer.group.remove(this.group)}createThreeGeomety(t){const s=this.layer.getRenderTransform().createRenderCoordinatesSync(t),e=V(s,3).map(l=>new I(l[0],l[1],l[2])),r=new K(e[0],e[1],e[2]);return new J(r,50,this.layer.radius,8,!1)}addControlPoints(t){const a=[];for(let s=0;s<t.length-1;s++){const e=t[s],r=t[s+1],n=e.z||0,l=r.z||0,E=new N({x:(e.x+r.x)/2,y:(e.y+r.y)/2,z:(n+l)/2+this.calculateHeightBasedOnLength([e,r]),spatialReference:e.spatialReference});a.push(e,E)}return a.push(t[t.length-1]),a}pathsFromGraphic(){const t=this.graphic.geometry;if(!t)throw new TypeError("geometry is not a polyline");return Z(t).map(s=>{if(s.length<2)throw new TypeError("path must have at least two points");return this.addControlPoints(s)})}calculateHeightBasedOnLength(t,a=40*1e3){let s=0;for(let r=0;r<t.length-1;r++){const n=P(t[r],t[r+1]);s+=n}return s*a}}let c=class extends ee(Y){constructor(){super(...arguments),this.radius=1500,this.color=new m(8759721),this.texture=null}init(){this.material=new q({side:Q,transparent:!0,depthWrite:!1,opacity:1,color:this.color,map:this.texture}),this.entities=this.source.map(o=>new ge({graphic:o,layer:this})),this.handles.push(this.watch("radius",()=>{this.refresh()})),this.handles.push(this.watch("color",()=>{this.getMaterial().color=this.color,this.getContext().renderNode?.requestRender()})),this.handles.push(this.watch("texture",()=>{this.getMaterial().map=this.texture,this.getContext().renderNode?.requestRender()}))}animate(o){if(!this.visible)return;const t=this.getMaterial().map;t&&(t.offset.x-=.01,o.renderNode?.requestRender())}getMaterial(){return this.material}};_([C({type:Number})],c.prototype,"radius",2);_([C({type:m})],c.prototype,"color",2);_([C({type:X})],c.prototype,"texture",2);c=_([A("vuesri.three.ArcLayer")],c);x.install=o=>{o.component(x.name||"VathArcLayer",x)};const ct=M({__name:"basic",setup(o){const t=h(""),a=h(!0),s=h([new f({geometry:new g({paths:[[[115.80895340787583,30.92933111293343],[115.86231959908358,30.99068362090549]]]}),attributes:{name:"管线1",type:"管线",id:"1"}}),new f({geometry:new g({paths:[[[115.80895340787583,30.92933111293343],[120.86231959908358,30.99068362090549]]]}),attributes:{name:"管线1",type:"管线",id:"2"}})]),e=h([new f({geometry:new g({paths:[[[115.80895340787583,30.92933111293343],[115.86231959908358,30.99068362090549]]]}),attributes:{name:"管线1",type:"管线",id:"1"}}),new f({geometry:new g({paths:[[[115.80895340787583,30.92933111293343],[120.86231959908358,30.99068362090549]]]}),attributes:{name:"管线1",type:"管线2",id:"2"}})]),r=h(new m(16711680)),n=async d=>{await d.layer.when(),d.view.goTo(d.layer.fullExtent,{animate:!1})},l=()=>{r.value=new m(65280)},E=()=>{e.value=e.value.length?[]:s.value},G=()=>{t.value=t.value?"":"/vuesri-three/ThreeRenderer/images/arc_layer_texture.png"};return(d,i)=>{const y=B("ElButton");return L(),$(v(S),null,{before:u(()=>[le("p",null,[p(y,{onClick:l},{default:u(()=>i[1]||(i[1]=[w(" 颜色 ")])),_:1}),p(y,{onClick:E},{default:u(()=>i[2]||(i[2]=[w(" 数据 ")])),_:1}),p(y,{onClick:G},{default:u(()=>i[3]||(i[3]=[w(" 材质 ")])),_:1}),p(y,{onClick:i[0]||(i[0]=we=>a.value=!a.value)},{default:u(()=>[w(" if "+ue(a.value),1)]),_:1})])]),default:u(()=>[p(v(O),{type:"vec_w","spatial-reference":{wkid:102100}}),p(v(z),null,{default:u(()=>[a.value?(L(),$(v(x),{key:0,"texture-url":t.value,source:e.value,radius:1500,color:r.value,onLoad:n},null,8,["texture-url","source","color"])):pe("",!0)]),_:1})]),_:1})}}});export{ct as default};
