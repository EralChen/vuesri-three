import{iI as E,iJ as _,iK as m,iE as n,iL as c,iM as x,bC as p,cv as A,iN as C}from"./chunk-C4bXDfxA.js";import{H as I,t as d}from"./chunk-D_yTKJJf.js";function T(e,o,t,r){if(o==null||r==null)return!1;const s=_(o,r,P);if(s.projector===m)return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],!0;if(s.projector==null)return!1;const{source:i,dest:a}=s;if(a.spatialReferenceId===n.WEB_MERCATOR){const u=c[i.spatialReferenceId][n.WGS84];return u!=null&&(u(e,0,f,0),x(f,0,t,0),t[3]=h(f[1],e[2],e[3],p.radius),!0)}if(i.spatialReferenceId!==n.WGS84&&i.spatialReferenceId!==n.CGCS2000||a.spatialReferenceId!==n.PLATE_CARREE){s.projector(e,0,t,0);const u=i.metersPerUnit??1,l=a.metersPerUnit??1;t[3]=e[3]*u/l}else{const u=c[i.spatialReferenceId][n.SPHERICAL_ECEF],l=c[n.SPHERICAL_ECEF][n.PLATE_CARREE];let R=e[3];u!=null&&l!=null&&(R=h(e[1],e[2],e[3],p.radius)),s.projector(e,0,t,0),t[3]=R}return!0}function h(e,o,t,r){const s=r+o;if(s<r/2||t>s)return Number.MAX_VALUE;const i=Math.abs(M*e)+Math.asin(t/s);return i>=Math.PI/2?Number.MAX_VALUE:t/Math.cos(i)}const f=A(),P=E(),M=C(1);class ${constructor(o,t){this._textureRep=o,this.loadPromise=null,this._disposed=!1;const r=this._textureRep.acquire(t);I(r)?(r.then(s=>{this._disposed?d(s):this._textureRef=s}),this.loadPromise=r):this._textureRef=r}dispose(){this._textureRef=d(this._textureRef),this._disposed=!0}get glTexture(){return this._textureRef!=null?this._textureRef.glTexture:null}}export{T as a,$ as s};
