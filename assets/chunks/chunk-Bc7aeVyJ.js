import{b3 as N,p9 as P,w as y,ey as f}from"./chunk-C4bXDfxA.js";import{y as L,e as A}from"./chunk-D_yTKJJf.js";import{a as O,b as S}from"./chunk-CW_9Je75.js";import{V as z}from"./chunk-DxsSVHaj.js";import{e as k,_ as D,c as H}from"./chunk-CoGOGEcF.js";import{f as p,u as j,g as F,R as T,a as U,c as q,i as Q,G as R,b as W,V as I,Q as J,l as K,h as X}from"./chunk-c5QbCJQU.js";import{E as Y}from"./chunk-JLSFcfLv.js";import{p as Z}from"./chunk-EBoT1v4r.js";import"./chunk-CIGiVJhy.js";import{M as ee}from"./chunk-DuGLBUlI.js";import{d as $,w as te,a as E,Q as re,R as se,j as B,b,c as ae,k as c,S as oe,r as ne,M as ie,U as V,s as h,p as M,l,e as le,f as g,t as ce,u as w,B as ue}from"./chunk-CDohQU0g.js";import"./chunk--6mYOZ3I.js";import"./chunk-CcyKeARz.js";const he={source:{type:Array,default:()=>[]},radius:{type:Number,default:1500},color:{type:Object,default:new p(8759721)},textureUrl:{type:String,default:""}},pe={load:o=>o,...k},de=$({name:"VathArcLayer",components:{VathEntityLayerEvents:D},props:he,emits:pe,setup(o,{emit:t}){const a=j(),s=H(t),e=new u({source:o.source});return te(()=>o.source,r=>{e.source=r,e.refresh()}),E(()=>{e.radius=o.radius}),E(()=>{e.color=o.color}),E(()=>{o.textureUrl?e.texture=function(){const r=new F().load(o.textureUrl);return r.wrapS=T,r.wrapT=T,r.repeat.set(1,1),r}():e.texture=null}),U(a,e),t("load",{layer:e,renderer:a,view:a.view}),re("vathEntityLayer",e),{eventsEmits:s}}});function me(o,t,a,s,e,r){const n=B("VathEntityLayerEvents");return b(),ae(ie,null,[c(n,oe(o.eventsEmits),null,16),ne(o.$slots,"default")],64)}const v=se(de,[["render",me]]);var ye=Object.defineProperty,fe=Object.getOwnPropertyDescriptor,_=(o,t,a,s)=>{for(var e=s>1?void 0:s?fe(t,a):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(e=(s?n(t,a,e):n(e))||e);return s&&e&&ye(t,a,e),e};class ge{constructor(t){this.group=new R,this.paths=[],this.lines=[],this.layer=t.layer,this.graphic=t.graphic}setup(){this.lines=[],this.paths=this.pathsFromGraphic();const a=this.paths.reduce((s,e)=>(V(e,3).forEach(n=>{s.push(this.createThreeGeomety(n))}),s),[]).map(s=>{const e=new R,r=new W(s,this.layer.getMaterial());return this.lines.push(r.geometry),e.add(r),e});this.group.add(...a),this.layer.group.add(this.group)}dispose(){this.group.clear(),this.layer.group.remove(this.group)}createThreeGeomety(t){const s=this.layer.getRenderTransform().createRenderCoordinatesSync(t),e=V(s,3).map(i=>new I(i[0],i[1],i[2])),r=new J(e[0],e[1],e[2]);return new K(r,50,this.layer.radius,8,!1)}addControlPoints(t){const a=[];for(let s=0;s<t.length-1;s++){const e=t[s],r=t[s+1],n=e.z||0,i=r.z||0,x=new N({x:(e.x+r.x)/2,y:(e.y+r.y)/2,z:(n+i)/2+this.calculateHeightBasedOnLength([e,r]),spatialReference:e.spatialReference});a.push(e,x)}return a.push(t[t.length-1]),a}pathsFromGraphic(){const t=this.graphic.geometry;if(!t)throw new TypeError("geometry is not a polyline");return Z(t).map(s=>{if(s.length<2)throw new TypeError("path must have at least two points");return this.addControlPoints(s)})}calculateHeightBasedOnLength(t,a=40*1e3){let s=0;for(let r=0;r<t.length-1;r++){const n=P(t[r],t[r+1]);s+=n}return s*a}}let u=class extends ee(Y){constructor(){super(...arguments),this.radius=1500,this.color=new p(8759721),this.texture=null}init(){this.material=new q({side:Q,transparent:!0,depthWrite:!1,opacity:1,color:this.color,map:this.texture}),this.entities=this.source.map(o=>new ge({graphic:o,layer:this})),this.handles.push(this.watch("radius",()=>{this.refresh()})),this.handles.push(this.watch("color",()=>{this.getMaterial().color=this.color,this.getContext().renderNode?.requestRender()})),this.handles.push(this.watch("texture",()=>{this.getMaterial().map=this.texture,this.getContext().renderNode?.requestRender()}))}animate(o){if(!this.visible)return;const t=this.getMaterial().map;t&&(t.offset.x-=.01,o.renderNode?.requestRender())}getMaterial(){return this.material}};_([L({type:Number})],u.prototype,"radius",2);_([L({type:p})],u.prototype,"color",2);_([L({type:X})],u.prototype,"texture",2);u=_([A("vuesri.three.ArcLayer")],u);v.install=o=>{o.component(v.name||"VathArcLayer",v)};const Ge=$({__name:"basic",setup(o){const t=h(""),a=h(!0),s=h([new y({geometry:new f({paths:[[[115.80895340787583,30.92933111293343],[115.86231959908358,30.99068362090549]]]}),attributes:{name:"管线1",type:"管线",id:"1"}}),new y({geometry:new f({paths:[[[115.80895340787583,30.92933111293343],[120.86231959908358,30.99068362090549]]]}),attributes:{name:"管线1",type:"管线",id:"2"}})]),e=h([new y({geometry:new f({paths:[[[115.80895340787583,30.92933111293343],[115.86231959908358,30.99068362090549]]]}),attributes:{name:"管线1",type:"管线",id:"1"}}),new y({geometry:new f({paths:[[[115.80895340787583,30.92933111293343],[120.86231959908358,30.99068362090549]]]}),attributes:{name:"管线1",type:"管线2",id:"2"}})]),r=h(new p(16711680)),n=async d=>{await d.layer.when(),d.view.goTo(d.layer.fullExtent,{animate:!1})},i=()=>{r.value=new p(65280)},x=()=>{e.value=e.value.length?[]:s.value},G=()=>{t.value=t.value?"":"/vuesri-three/ThreeRenderer/images/arc_layer_texture.png"};return(d,C)=>{const m=B("ElButton");return b(),M(w(S),null,{before:l(()=>[le("p",null,[c(m,{onClick:i},{default:l(()=>[g(" 颜色 ")]),_:1}),c(m,{onClick:x},{default:l(()=>[g(" 数据 ")]),_:1}),c(m,{onClick:G},{default:l(()=>[g(" 材质 ")]),_:1}),c(m,{onClick:C[0]||(C[0]=we=>a.value=!a.value)},{default:l(()=>[g(" if "+ce(a.value),1)]),_:1})])]),default:l(()=>[c(w(O),{type:"vec_w","spatial-reference":{wkid:102100}}),c(w(z),null,{default:l(()=>[a.value?(b(),M(w(v),{key:0,"texture-url":t.value,source:e.value,radius:1500,color:r.value,onLoad:n},null,8,["texture-url","source","color"])):ue("",!0)]),_:1})]),_:1})}}});export{Ge as default};
