import{b3 as $,p9 as B,w as d,ey as m}from"./chunk-JaFSy54E.js";import{y as b,e as G}from"./chunk-D_yTKJJf.js";import{a as P,b as N}from"./chunk-DhngCxSs.js";import{V as A}from"./chunk-DaUEBtKy.js";import{e as O,_ as S,c as z,u as L}from"./chunk-C7H_V7PA.js";import{f as h,u as H,g as j,R as T,a as D,c as F,i as k,G as C,b as q,V as Q,Q as U,l as W,h as K}from"./chunk-DY5FnirW.js";import{E as I}from"./chunk-DacOX0Bd.js";import{p as J}from"./chunk-CSw4HZ_e.js";import"./chunk-Cv0KyIMc.js";import{M as X}from"./chunk-fihD0T31.js";import{d as R,w as Y,a as x,Q as Z,R as ee,j as V,b as M,c as te,k as c,S as re,r as se,K as ae,s as y,p as oe,l,e as ne,f as E,u as f}from"./chunk-DW0GXzYX.js";import"./chunk-FKPdDv5g.js";import"./chunk-DfHyU302.js";const ie={source:{type:Array,default:()=>[]},radius:{type:Number,default:1500},color:{type:Object,default:new h(8759721)},textureUrl:{type:String,default:""}},ce={load:a=>a,...O},le=R({name:"VathArcLayer",components:{VathEntityLayerEvents:S},props:ie,emits:ce,setup(a,{emit:t}){const o=H(),r=z(t),e=new u({source:a.source});return Y(()=>a.source,s=>{e.source=s,e.refresh()}),x(()=>{e.radius=a.radius}),x(()=>{e.color=a.color}),x(()=>{a.textureUrl?e.texture=function(){const s=new j().load(a.textureUrl);return s.wrapS=T,s.wrapT=T,s.repeat.set(1,1),s}():e.texture=null}),D(o,e),t("load",{layer:e,renderer:o,view:o.view}),Z("vathEntityLayer",e),{eventsEmits:r}}});function ue(a,t,o,r,e,s){const n=V("VathEntityLayerEvents");return M(),te(ae,null,[c(n,re(a.eventsEmits),null,16),se(a.$slots,"default")],64)}const g=ee(le,[["render",ue]]);var he=Object.defineProperty,pe=Object.getOwnPropertyDescriptor,w=(a,t,o,r)=>{for(var e=r>1?void 0:r?pe(t,o):t,s=a.length-1,n;s>=0;s--)(n=a[s])&&(e=(r?n(t,o,e):n(e))||e);return r&&e&&he(t,o,e),e};class de{constructor(t){this.group=new C,this.paths=[],this.lines=[],this.layer=t.layer,this.graphic=t.graphic}setup(){this.lines=[],this.paths=this.pathsFromGraphic();const o=this.paths.reduce((r,e)=>(L(e,3).forEach(n=>{r.push(this.createThreeGeomety(n))}),r),[]).map(r=>{const e=new C,s=new q(r,this.layer.getMaterial());return this.lines.push(s.geometry),e.add(s),e});this.group.add(...o),this.layer.group.add(this.group)}dispose(){this.group.clear(),this.layer.group.remove(this.group)}createThreeGeomety(t){const r=this.layer.getRenderTransform().createRenderCoordinatesSync(t),e=L(r,3).map(i=>new Q(i[0],i[1],i[2])),s=new U(e[0],e[1],e[2]);return new W(s,50,this.layer.radius,8,!1)}addControlPoints(t){const o=[];for(let r=0;r<t.length-1;r++){const e=t[r],s=t[r+1],n=e.z||0,i=s.z||0,v=new $({x:(e.x+s.x)/2,y:(e.y+s.y)/2,z:(n+i)/2+this.calculateHeightBasedOnLength([e,s]),spatialReference:e.spatialReference});o.push(e,v)}return o.push(t[t.length-1]),o}pathsFromGraphic(){const t=this.graphic.geometry;if(!t)throw new TypeError("geometry is not a polyline");return J(t).map(r=>{if(r.length<2)throw new TypeError("path must have at least two points");return this.addControlPoints(r)})}calculateHeightBasedOnLength(t,o=40*1e3){let r=0;for(let s=0;s<t.length-1;s++){const n=B(t[s],t[s+1]);r+=n}return r*o}}let u=class extends X(I){constructor(){super(...arguments),this.radius=1500,this.color=new h(8759721),this.texture=null}init(){this.material=new F({side:k,transparent:!0,depthWrite:!1,opacity:1,color:this.color,map:this.texture}),this.entities=this.source.map(a=>new de({graphic:a,layer:this})),this.handles.push(this.watch("radius",()=>{this.refresh()})),this.handles.push(this.watch("color",()=>{this.getMaterial().color=this.color,this.getContext().renderNode?.requestRender()})),this.handles.push(this.watch("texture",()=>{this.getMaterial().map=this.texture,this.getContext().renderNode?.requestRender()}))}animate(a){if(!this.visible)return;const t=this.getMaterial().map;t&&(t.offset.x-=.01,a.renderNode?.requestRender())}getMaterial(){return this.material}};w([b({type:Number})],u.prototype,"radius",2);w([b({type:h})],u.prototype,"color",2);w([b({type:K})],u.prototype,"texture",2);u=w([G("vuesri.three.ArcLayer")],u);g.install=a=>{a.component(g.name||"VathArcLayer",g)};const Ve=R({__name:"basic",setup(a){const t=y(""),o=y([new d({geometry:new m({paths:[[[115.80895340787583,30.92933111293343],[115.86231959908358,30.99068362090549]]]}),attributes:{name:"管线1",type:"管线",id:"1"}}),new d({geometry:new m({paths:[[[115.80895340787583,30.92933111293343],[120.86231959908358,30.99068362090549]]]}),attributes:{name:"管线1",type:"管线",id:"2"}})]),r=y([new d({geometry:new m({paths:[[[115.80895340787583,30.92933111293343],[115.86231959908358,30.99068362090549]]]}),attributes:{name:"管线1",type:"管线",id:"1"}}),new d({geometry:new m({paths:[[[115.80895340787583,30.92933111293343],[120.86231959908358,30.99068362090549]]]}),attributes:{name:"管线1",type:"管线2",id:"2"}})]),e=y(new h(16711680)),s=async p=>{await p.layer.when(),p.view.goTo(p.layer.fullExtent,{animate:!1})},n=()=>{e.value=new h(65280)},i=()=>{r.value=r.value.length?[]:o.value},v=()=>{t.value=t.value?"":"/docs/vuesri-three/ThreeRenderer/images/arc_layer_texture.png"};return(p,me)=>{const _=V("ElButton");return M(),oe(f(N),null,{before:l(()=>[ne("p",null,[c(_,{onClick:n},{default:l(()=>[E(" 颜色 ")]),_:1}),c(_,{onClick:i},{default:l(()=>[E(" 数据 ")]),_:1}),c(_,{onClick:v},{default:l(()=>[E(" 材质 ")]),_:1})])]),default:l(()=>[c(f(P),{type:"vec_w","spatial-reference":{wkid:102100}}),c(f(A),null,{default:l(()=>[c(f(g),{"texture-url":t.value,source:r.value,radius:1500,color:e.value,onLoad:s},null,8,["texture-url","source","color"])]),_:1})]),_:1})}}});export{Ve as default};
