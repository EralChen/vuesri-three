import{w as h,b3 as d}from"./chunk-C4bXDfxA.js";import"./chunk-D_yTKJJf.js";import{d as O,a as T,b as _}from"./chunk-aIpoUDE5.js";import{V as L}from"./chunk-DwVxjFdS.js";import{o as x,C as f,f as m,b as I,p as g,G as D,u as W,a as M,i as k,F as $,q as F}from"./chunk-4ztk2S2V.js";import{G}from"./chunk-CY2pUGLO.js";import{W as P,X as R,Y as S,d as y,w as V,R as E,r as U,q,x as z,b as B,p as N,m as w,l as u,u as p}from"./chunk-DZT0J2Fy.js";import{E as X}from"./chunk-8EtOKnRZ.js";import{c as j,p as A}from"./chunk-EBoT1v4r.js";import"./chunk-pqN9uQLb.js";import"./chunk--6mYOZ3I.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-CcyKeARz.js";const b=["waveColor","waveDamping","waveLaps","waveOpacity","waveThreshold","waveIntensity","bgOpacity","bgColor"];class C extends x{constructor(e){super(P(e,b)),this.clock=new f,this.defaultParams={waveColor:"#0066ff",waveDamping:.3,waveLaps:2,waveOpacity:1,bgColor:"#000000",waveThreshold:0,bgOpacity:1,waveIntensity:1},this.params=R(this.defaultParams,e),this.uniforms={iTime:{value:.1},waveColor:{value:new m(this.params.waveColor)},unLaps:{value:this.params.waveLaps},waveOpacity:{value:this.params.waveOpacity},bgColor:{value:new m(this.params.bgColor)},waveThreshold:{value:this.params.waveThreshold},bgOpacity:{value:this.params.bgOpacity},waveIntensity:{value:this.params.waveIntensity}},this.vertexShader=`
      varying vec2 vUv;
      void main() {
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,this.fragmentShader=`
      varying vec2 vUv;
      uniform float iTime;
      uniform vec3 waveColor;
      uniform float unLaps;
      uniform float waveOpacity;
      uniform vec3 bgColor;
      uniform float waveThreshold;
      uniform float bgOpacity;
      uniform float waveIntensity;
      void main() {
        vec2 uv = vUv;
        vec2 p = 2.0 * uv.xy - vec2(1., 1.);
        float r = length(p) * 2.0;
        vec3 color = waveColor;
        float a = pow(r, unLaps);
        float b = sin(r * 0.8 - 1.6);
        float c = sin(r - .10);
        float s = sin(a - iTime * 3.0 + b) * c;
        color *= abs(waveIntensity / (s * 30.)) - 0.1;
        if (all(lessThanEqual(color, vec3(waveThreshold)))) {
          gl_FragColor = vec4(bgColor, bgOpacity);
        } else {
          gl_FragColor = vec4(color, waveOpacity);
        }
      }
    `,this.transparent=!0}set waveColor(e){this.uniforms.waveColor.value=new m(e)}get waveColor(){return this.uniforms.waveColor.value}set waveDamping(e){this.params.waveDamping=e}get waveDamping(){return this.params.waveDamping}get waveLaps(){return this.uniforms.unLaps.value}set waveLaps(e){this.uniforms.unLaps.value=e}get waveOpacity(){return this.uniforms.waveOpacity.value}set waveOpacity(e){this.uniforms.waveOpacity.value=e}get bgColor(){return this.uniforms.bgColor.value}set bgColor(e){this.uniforms.bgColor.value=new m(e)}get waveThreshold(){return this.uniforms.waveThreshold.value}set waveThreshold(e){this.uniforms.waveThreshold.value=e}get bgOpacity(){return this.uniforms.bgOpacity.value}set bgOpacity(e){this.uniforms.bgOpacity.value=e}get waveIntensity(){return this.uniforms.waveIntensity.value}set waveIntensity(e){this.uniforms.waveIntensity.value=e}loop(){const e=this.clock.getDelta();this.uniforms.iTime.value+=Math.sin(e*this.waveDamping)}}class K extends I{constructor(e=new g(64,64),r=new C){super(e,r),this.geometry=e,this.material=r,this.defaultOptions={},this.options={},this.clock=new f,this.render()}render(){this.rotateX(-Math.PI/2)}dispose(){this.removeFromParent(),this.geometry.dispose(),this.material.dispose()}loop(){this.material.loop()}}const Y={source:{type:Array,default:()=>[]}},H={load:a=>a};class J{constructor(e){this.group=new D,this.graphic=e.graphic,this.layer=e.layer}setup(){const{radius:e,segments:r,thetaStart:i,thetaLength:l}=this.graphic.attributes,s=S(this.graphic.attributes,b);this.geometry=new g(e||100,r||64,i,l),this.material=new C({...s}),this.diffusionWave=new K(this.geometry,this.material),this.diffusionWave.rotateX(Math.PI/2);const{material:t}=this.diffusionWave;t&&(t.transparent=!0);const n=this.pathsFromGraphic();this.setPosition(n[0]),this.layer.group.add(this.diffusionWave)}animate(){this.diffusionWave?.loop()}dispose(){this.diffusionWave?.dispose()}pathsFromGraphic(){const e=j(this.graphic.geometry);if(e.type!=="point")throw new Error("geometry type must be point");return A(e)}setPosition(e){const r=this.layer.getRenderTransform().createTransformMatrix4(e[0]);this.diffusionWave.applyMatrix4(r)}}class Q extends X{constructor(e){super(e)}init(){this.entities=this.source.map(e=>new J({graphic:e,layer:this}))}animate(e){super.animate(e),e.renderNode?.requestRender()}}const Z=y({name:"VathWaveLayer",props:Y,emits:H,setup(a,{emit:e}){const r=new Q({source:a.source}),i=W();return V(()=>a.source,()=>{r.source=a.source,r.refresh()}),e("load",{layer:r,renderer:i,view:i.view}),M(i,r),{}}});function ee(a,e,r,i,l,s){return U(a.$slots,"default")}const v=E(Z,[["render",ee]]);v.install=a=>{a.component(v.name,v)};const je=y({__name:"basic",setup(a){const e={center:[120.81657563861,30],zoom:18,spatialReference:{wkid:102100}},r=[new h({geometry:new d({longitude:120.80657463861,latitude:30,z:50}),attributes:{}}),new h({geometry:new d({longitude:120.82657463861,latitude:30,z:50}),attributes:{}}),new h({geometry:new d({longitude:120.81657563861,latitude:30,z:10}),attributes:{radius:100,segments:64,waveColor:"#331282",waveDamping:.3,waveLaps:2,waveOpacity:1,waveThreshold:.5,waveIntensity:20,bgOpacity:0,bgColor:"#000000"}})];let i;function l(t){i=t.layer}const s=q(null);return z(()=>{const t=new G({container:s.value.$el});i.when().then(()=>{const n=i.group.children[2],o=n.material;t.add(o,"visible").name("是否可见 visible"),t.add(o,"waveOpacity",0,1).name("透明度 waveOpacity"),t.addColor(o,"waveColor").name("颜色 waveColor"),t.add(o,"waveDamping",0,1).name("速度 waveDamping"),t.add(o,"waveLaps",0,3,1).name("圈数 waveLaps"),t.addColor(o,"bgColor").name("背景色 bgColor"),t.add(o,"bgOpacity",0,1,.1).name("背景透明度 bgOpacity"),t.add(o,"waveIntensity",0,20,.1).name("光圈宽度 waveIntensity"),t.add(o,"waveThreshold",0,3,.01).name("背景与光圈的色差 waveThreshold"),t.add(o,"side",{DoubleSide:k,FrontSide:$,BackSide:F}).name("渲染面 side"),t.add({scale:1},"scale",1,100,1).onChange(c=>{n.scale.set(c,c,c)}).name("缩放 scale")})}),(t,n)=>(B(),N(p(_),{"default-options":e},{default:w(()=>[u(p(O),{ref_key:"boxRef",ref:s,position:"top-right"},null,512),u(p(T),{type:"vec_w","spatial-reference":{wkid:102100}}),u(p(L),null,{default:w(()=>[u(p(v),{source:r,onLoad:l})]),_:1})]),_:1}))}});export{je as default};
